<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>Cloudwatch Agent by wdalmut</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Cloudwatch Agent</h1>
        <h2>Cloudwatch Agent - UDP/IP long running process for AWS CloudWatch</h2>

        <section id="downloads">
          <a href="https://github.com/wdalmut/cloudwatch-agent/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/wdalmut/cloudwatch-agent/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/wdalmut/cloudwatch-agent" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <p>CloudWatch Agent is a long running process that collects your application information and sent them to CloudWatch every minute. The goal of this monitor is to reduce the time overhead introduced by CloudWatch SDK and also all write operation to the service.</p>

<p>Thanks to the agent you can collect a wide range of metrics like: exceptions, timing about your application using a single monitor tool in your AWS space: CloudWatch.</p>

<h2>
<a name="getting-started" class="anchor" href="#getting-started"><span class="octicon octicon-link"></span></a>Getting Started</h2>

<p>The agent works using UDP/IP packages on <code>127.0.0.1</code>, we just have to send simple JSON package to the monitor on port <code>1234</code></p>

<pre><code>{"namespace": "wdm", "metric": "indexer-timing", "value": 81.21}
</code></pre>

<p>Before use the service remember to configure the AWS ApiKey and SecretKey in the daemon configuration file at <code>/etc/default/cloudwatch-agent</code> you can also tweak monitor option tuning the configuration file at: <code>/etc/cloudwatch-agent/cloudwatch-agent.conf</code></p>

<p>You can try the daemon using <code>nc</code> tool:</p>

<pre><code>echo '{"namespace": "wdm", "metric": "indexer-timing", "value": 81.21}' | nc -u localhost 1234
</code></pre>

<h2>
<a name="advanced-usage" class="anchor" href="#advanced-usage"><span class="octicon octicon-link"></span></a>Advanced usage</h2>

<p>The complete data packet structure is quite bit more complex:</p>

<pre><code>{
    "namespace": ...
    "metric": ...
    "unit": ...
    "value": ...
    "op": ...
}
</code></pre>

<p>Where you can tune also the operation type and the metric unit. Valid operations are:</p>

<ul>
<li>
<code>avg</code> - Compute the average of all packages</li>
<li>
<code>sum</code> - Sum all incoming samples</li>
<li>
<code>max</code> - Send only the max point</li>
<li>
<code>min</code> - Send only the min point</li>
</ul><p>Valid units are:</p>

<ul>
<li><code>Seconds</code></li>
<li><code>Microseconds</code></li>
<li><code>Milliseconds</code></li>
<li><code>Bytes</code></li>
<li><code>Kilobytes</code></li>
<li><code>Megabytes</code></li>
<li><code>Gigabytes</code></li>
<li><code>Terabytes</code></li>
<li><code>Bits</code></li>
<li><code>Kilobits</code></li>
<li><code>Megabits</code></li>
<li><code>Gigabits</code></li>
<li><code>Terabits</code></li>
<li><code>Percent</code></li>
<li><code>Count</code></li>
<li><code>Bytes/Second</code></li>
<li><code>Kilobytes/Second</code></li>
<li><code>Megabytes/Second</code></li>
<li><code>Gigabytes/Second</code></li>
<li><code>Terabytes/Second</code></li>
<li><code>Bits/Second</code></li>
<li><code>Kilobits/Second</code></li>
<li><code>Megabits/Second</code></li>
<li><code>Gigabits/Second</code></li>
<li><code>Terabits/Second</code></li>
<li><code>Count/Second</code></li>
</ul><h2>
<a name="install-the-agent" class="anchor" href="#install-the-agent"><span class="octicon octicon-link"></span></a>Install the agent</h2>

<h3>
<a name="debian-family" class="anchor" href="#debian-family"><span class="octicon octicon-link"></span></a>Debian Family</h3>

<p>If you use a Debian like distribution you can use the precompiled package</p>

<pre><code>echo "deb http://dl.bintray.com/wdalmut/deb /" | sudo tee /etc/apt/sources.list.d/wdalmut.list
echo "#deb-src http://dl.bintray.com/wdalmut/deb /" | sudo tee -a /etc/apt/sources.list.d/wdalmut.list
</code></pre>

<p>Now just update your repository</p>

<pre><code>sudo apt-get update
</code></pre>

<p>And install the monitor</p>

<pre><code>sudo apt-get install cloudwatch-agent
</code></pre>

<h3>
<a name="rhel-family" class="anchor" href="#rhel-family"><span class="octicon octicon-link"></span></a>RHEL family</h3>

<p>If you use a RedHat based distribution add the RPM repository</p>

<pre><code>wget https://bintray.com/wdalmut/rpm/rpm -O bintray-wdalmut-rpm.repo
sudo mv bintray-wdalmut-rpm.repo /etc/yum.repos.d/
</code></pre>

<p>now just install it</p>

<pre><code>sudo yum install cloudwatch-agent.x86_64
</code></pre>

<h2>
<a name="start-the-agent" class="anchor" href="#start-the-agent"><span class="octicon octicon-link"></span></a>Start the agent</h2>

<p>After the installation process and the configuration you can start the agent using the common service interface.</p>

<pre><code>sudo service cw-agent start
</code></pre>

<p>Allowed operations are:</p>

<ul>
<li>start</li>
<li>stop</li>
<li>status</li>
<li>restart</li>
</ul><h2>
<a name="examples-of-usage" class="anchor" href="#examples-of-usage"><span class="octicon octicon-link"></span></a>Examples of usage</h2>

<p>Just as example you can count the number of exception in your application just sending a simple packet for each exception catched</p>

<pre><code>{
    "namespace": "app"
    "metric": "errors"
    "value": 1
    "op": "sum"
}
</code></pre>

<p>For each exception we can collect the total number in a minute and send the total amount to CloudWatch every minute.</p>
      </section>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-54115109-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>