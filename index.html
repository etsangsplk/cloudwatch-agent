<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Cloudwatch Agent : Cloudwatch Agent - UDP/IP long running process for AWS CloudWatch">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Cloudwatch Agent</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/wdalmut/cloudwatch-agent">View on GitHub</a>

          <h1 id="project_title">Cloudwatch Agent</h1>
          <h2 id="project_tagline">Cloudwatch Agent - UDP/IP long running process for AWS CloudWatch</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/wdalmut/cloudwatch-agent/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/wdalmut/cloudwatch-agent/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p>CloudWatch Agent is a long running process that collects your application information and sent them to CloudWatch every minute. The goal of this monitor is to reduce the time overhead introduced by CloudWatch SDK and also all write operation to the service.</p>

<p>Thanks to the agent you can collect a wide range of metrics like: exceptions, timing about your application using a single monitor tool in your AWS space: CloudWatch.</p>

<h2>
<a name="getting-started" class="anchor" href="#getting-started"><span class="octicon octicon-link"></span></a>Getting Started</h2>

<p>The agent works using UDP/IP packages on <code>127.0.0.1</code>, we just have to send simple JSON package to the monitor on port <code>1234</code></p>

<pre><code>{"namespace": "wdm", "metric": "indexer-timing", "value": 81.21}
</code></pre>

<p>Before use the service remember to configure the AWS ApiKey and SecretKey in the daemon configuration file at <code>/etc/default/cloudwatch-agent</code> you can also tweak monitor option tuning the configuration file at: <code>/etc/cloudwatch-agent/cloudwatch-agent.conf</code></p>

<p>You can try the daemon using <code>nc</code> tool:</p>

<pre><code>echo '{"namespace": "wdm", "metric": "indexer-timing", "value": 81.21}' | nc -u localhost 1234
</code></pre>

<h2>
<a name="advanced-usage" class="anchor" href="#advanced-usage"><span class="octicon octicon-link"></span></a>Advanced usage</h2>

<p>The complete data packet structure is quite bit more complex:</p>

<pre><code>{
    "namespace": ...
    "metric": ...
    "unit": ...
    "value": ...
    "op": ...
}
</code></pre>

<p>Where you can tune also the operation type and the metric unit. Valid operations are:</p>

<ul>
<li>
<code>avg</code> - Compute the average of all packages</li>
<li>
<code>sum</code> - Sum all incoming samples</li>
<li>
<code>max</code> - Send only the max point</li>
<li>
<code>min</code> - Send only the min point</li>
</ul><p>Valid units are:</p>

<ul>
<li><code>Seconds</code></li>
<li><code>Microseconds</code></li>
<li><code>Milliseconds</code></li>
<li><code>Bytes</code></li>
<li><code>Kilobytes</code></li>
<li><code>Megabytes</code></li>
<li><code>Gigabytes</code></li>
<li><code>Terabytes</code></li>
<li><code>Bits</code></li>
<li><code>Kilobits</code></li>
<li><code>Megabits</code></li>
<li><code>Gigabits</code></li>
<li><code>Terabits</code></li>
<li><code>Percent</code></li>
<li><code>Count</code></li>
<li><code>Bytes/Second</code></li>
<li><code>Kilobytes/Second</code></li>
<li><code>Megabytes/Second</code></li>
<li><code>Gigabytes/Second</code></li>
<li><code>Terabytes/Second</code></li>
<li><code>Bits/Second</code></li>
<li><code>Kilobits/Second</code></li>
<li><code>Megabits/Second</code></li>
<li><code>Gigabits/Second</code></li>
<li><code>Terabits/Second</code></li>
<li><code>Count/Second</code></li>
</ul><h2>
<a name="install-the-agent" class="anchor" href="#install-the-agent"><span class="octicon octicon-link"></span></a>Install the agent</h2>

<h3>
<a name="debian-family" class="anchor" href="#debian-family"><span class="octicon octicon-link"></span></a>Debian Family</h3>

<p>If you use a Debian like distribution you can use the precompiled package</p>

<pre><code>echo "deb http://dl.bintray.com/wdalmut/deb /" | sudo tee /etc/apt/sources.list.d/wdalmut.list
echo "#deb-src http://dl.bintray.com/wdalmut/deb /" | sudo tee -a /etc/apt/sources.list.d/wdalmut.list
</code></pre>

<p>Now just update your repository</p>

<pre><code>sudo apt-get update
</code></pre>

<p>And install the monitor</p>

<pre><code>sudo apt-get install cloudwatch-agent
</code></pre>

<h3>
<a name="rhel-family" class="anchor" href="#rhel-family"><span class="octicon octicon-link"></span></a>RHEL family</h3>

<p>If you use a RedHat based distribution add the RPM repository</p>

<pre><code>wget https://bintray.com/wdalmut/rpm/rpm -O bintray-wdalmut-rpm.repo
sudo mv bintray-wdalmut-rpm.repo /etc/yum.repos.d/
</code></pre>

<p>now just install it</p>

<pre><code>sudo yum install cloudwatch-agent.x86_64
</code></pre>

<h2>
<a name="start-the-agent" class="anchor" href="#start-the-agent"><span class="octicon octicon-link"></span></a>Start the agent</h2>

<p>After the installation process and the configuration you can start the agent using the common service interface.</p>

<pre><code>sudo service cw-agent start
</code></pre>

<p>Allowed operations are:</p>

<ul>
<li>start</li>
<li>stop</li>
<li>status</li>
<li>restart</li>
</ul><h2>
<a name="examples-of-usage" class="anchor" href="#examples-of-usage"><span class="octicon octicon-link"></span></a>Examples of usage</h2>

<p>Just as example you can count the number of exception in your application just sending a simple packet for each exception catched</p>

<pre><code>{
    "namespace": "app"
    "metric": "errors"
    "value": 1
    "op": "sum"
}
</code></pre>

<p>For each exception we can collect the total number in a minute and send the total amount to CloudWatch every minute.</p>

<h2>
<a name="sdks" class="anchor" href="#sdks"><span class="octicon octicon-link"></span></a>SDKs</h2>

<p>You can use pre-packaged agent sdk for your application</p>

<h3>
<a name="php-sdk" class="anchor" href="#php-sdk"><span class="octicon octicon-link"></span></a>PHP SDK</h3>

<p>In order to get the PHP SDK you have to add the agent dependency to your <code>composer.json</code> </p>

<pre><code>php composer.phar require corley/cloudwatch-agent-client:*
</code></pre>

<p>Now you can use directly in your application:</p>

<div class="highlight highlight-php"><pre><span class="nx">Corley\CloudWatch\Agent</span><span class="o">::</span><span class="na">point</span><span class="p">(</span><span class="nv">$namespace</span><span class="p">,</span> <span class="nv">$metric</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
</pre></div>

<p>Also with unit and the operation type:</p>

<div class="highlight highlight-php"><pre><span class="nx">Agent</span><span class="o">::</span><span class="na">point</span><span class="p">(</span><span class="nv">$namespace</span><span class="p">,</span> <span class="nv">$metric</span><span class="p">,</span> <span class="nv">$value</span><span class="p">,</span> <span class="p">[</span><span class="s2">"unit"</span> <span class="o">=&gt;</span> <span class="nx">Agent</span><span class="o">::</span><span class="na">UNIT_MILLISECONDS</span><span class="p">]);</span>
<span class="nx">Agent</span><span class="o">::</span><span class="na">point</span><span class="p">(</span><span class="nv">$namespace</span><span class="p">,</span> <span class="nv">$metric</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">"op"</span> <span class="o">=&gt;</span> <span class="nx">Agent</span><span class="o">::</span><span class="na">OP_SUM</span><span class="p">]);</span>
</pre></div>

<h2>
<a name="integrate-with-elasticbeanstalk" class="anchor" href="#integrate-with-elasticbeanstalk"><span class="octicon octicon-link"></span></a>Integrate with ElasticBeanStalk</h2>

<p>If you are running your application into and ElasticBeanStalk container you can host the <code>rpm</code> package by yourself on S3 and just add a configuration step in your <code>.ebextensions</code> folder</p>

<pre><code># .ebextensions/05_monitor.config
packages:
    rpm:
        monitor: https://s3-eu-west-1.amazonaws.com/your-bucket-name/cloudwatch-agent-0.0.11-1.x86_64.rpm
container_commands:
    05_put_aws_key:
        command: echo "export AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID" &gt; /etc/default/cloudwatch-agent &amp;&amp; echo "export AWS_SECRET_ACCESS_KEY=$AWS_SECRET_KEY" &gt;&gt; /etc/default/cloudwatch-agent
    06_stop_monitor:
        command: service cw-agent stop
        ignoreErrors: true
    07_start_monitor:
        command: service cw-agent start
        ignoreErrors: true
services:
    sysvinit:
        cw-agent:
            enabled: true
            ensureRunning: true
</code></pre>

<p>Just remember to configure your <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_KEY</code> via the ElasticBeanStalk application environment configuration.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Cloudwatch Agent maintained by <a href="https://github.com/wdalmut">wdalmut</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-54115109-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
